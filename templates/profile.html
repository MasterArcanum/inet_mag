{% extends "layout.html" %}

{% block title %}Личный кабинет{% endblock %}

{% block content %}
  {% include 'navbar.html' %}
  <div class="container mx-auto mt-8 px-4">
    <div class="flex items-center justify-between mb-6">
      <h1 class="text-4xl font-bold text-gray-800">Личный кабинет</h1>
      <!-- Переход на страницу редактирования профиля -->
      <a href="{{ url_for('edit_profile') }}" class="bg-green-800 text-white px-4 py-2 rounded hover:bg-green-700 transition-colors duration-300">
        Редактировать профиль
      </a>
    </div>
    <div class="bg-white rounded-lg shadow p-6 flex flex-col md:flex-row">
      <!-- Левая колонка: Данные пользователя -->
      <div class="md:w-1/2 md:pr-4">
        <h2 class="text-2xl font-bold mb-4">Мои данные</h2>
        <div class="space-y-3 text-gray-700">
          <p><span class="font-semibold">ФИО:</span> {{ user.full_name or "Не указано" }}</p>
          <p><span class="font-semibold">Контактный телефон:</span> {{ user.phone or "Не указан" }}</p>
          <p>
            <span class="font-semibold">Дата рождения:</span>
            {% if user.birth_date %}
              {{ user.birth_date.strftime('%d.%m.%Y') }}
            {% else %}
              Не указана
            {% endif %}
          </p>
          <p>
            <span class="font-semibold">Адрес доставки:</span>
            {% if user.city or user.street or user.house %}
              {{ user.city or '' }}
              {% if user.street %}, {{ user.street }}{% endif %}
              {% if user.house %} д. {{ user.house }}{% endif %}
              {% if not user.private_house and user.apartment %}, кв. {{ user.apartment }}{% endif %}
            {% else %}
              Не задан
            {% endif %}
          </p>
        </div>
        <div class="mt-6">
          <a href="{{ url_for('change_password') }}" class="bg-blue-800 text-white px-4 py-2 rounded hover:bg-blue-700 transition-colors duration-300">
            Изменить пароль
          </a>
        </div>
      </div>
      <!-- Правая колонка: Карта адреса доставки -->
      <div class="md:w-1/2 md:pl-4 mt-6 md:mt-0">
        <h2 class="text-2xl font-bold mb-4">Местоположение доставки</h2>
        {% if user.city or user.street or user.house %}
          <div class="w-full h-64 border rounded">
            {% set full_address = ((user.city or '') ~ ' ' ~ (user.street or '') ~ ' ' ~ (user.house or '') ~ (not user.private_house and user.apartment and (' кв. ' ~ user.apartment) or ''))|trim %}
            <iframe width="100%" height="100%" frameborder="0" style="border:0"
                    src="https://www.google.com/maps?q={{ full_address | urlencode }}&output=embed"
                    allowfullscreen></iframe>
          </div>
        {% else %}
          <p class="text-gray-700">Адрес доставки не задан.</p>
        {% endif %}
      </div>
    </div>
  </div>

{% endblock %}
